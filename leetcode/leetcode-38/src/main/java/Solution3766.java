import java.util.Arrays;
import java.util.Collections;
import java.util.List;

public class Solution3766 {
    // 打表代码
//    private static List<Integer> pals = new ArrayList<>();
//
//    static {
//        int maxLen = 17;
//        for (int L = 1; L <= maxLen; L++) {
//            int halfLen = (L + 1) / 2;
//            int start = 1 << (halfLen - 1);
//            int end = 1 << halfLen;
//            for (int x = start; x < end; x++) {
//                String bin = Integer.toBinaryString(x);
//                StringBuilder sb = new StringBuilder(bin);
//                if (L % 2 == 0) {
//                    sb.append(new StringBuilder(bin).reverse().toString());
//                } else {
//                    sb.append(new StringBuilder(bin.substring(0, bin.length() - 1)).reverse().toString());
//                }
//                String palBin = sb.toString();
//                int pal = Integer.parseInt(palBin, 2);
//                if (pal <= 65535) {
//                    pals.add(pal);
//                }
//            }
//        }
//        Set<Integer> set = new HashSet<>(pals);
//        pals = new ArrayList<>(set);
//        Collections.sort(pals);
//        System.out.println(pals);
//    }

    final List<Integer> PALS = Arrays.asList(1, 3, 5, 7, 9, 15, 17, 21, 27, 31, 33, 45, 51, 63, 65, 73, 85, 93, 99, 107, 119, 127, 129, 153, 165, 189, 195, 219, 231, 255, 257, 273, 297, 313, 325, 341, 365, 381, 387, 403, 427, 443, 455, 471, 495, 511, 513, 561, 585, 633, 645, 693, 717, 765, 771, 819, 843, 891, 903, 951, 975, 1023, 1025, 1057, 1105, 1137, 1161, 1193, 1241, 1273, 1285, 1317, 1365, 1397, 1421, 1453, 1501, 1533, 1539, 1571, 1619, 1651, 1675, 1707, 1755, 1787, 1799, 1831, 1879, 1911, 1935, 1967, 2015, 2047, 2049, 2145, 2193, 2289, 2313, 2409, 2457, 2553, 2565, 2661, 2709, 2805, 2829, 2925, 2973, 3069, 3075, 3171, 3219, 3315, 3339, 3435, 3483, 3579, 3591, 3687, 3735, 3831, 3855, 3951, 3999, 4095, 4097, 4161, 4257, 4321, 4369, 4433, 4529, 4593, 4617, 4681, 4777, 4841, 4889, 4953, 5049, 5113, 5125, 5189, 5285, 5349, 5397, 5461, 5557, 5621, 5645, 5709, 5805, 5869, 5917, 5981, 6077, 6141, 6147, 6211, 6307, 6371, 6419, 6483, 6579, 6643, 6667, 6731, 6827, 6891, 6939, 7003, 7099, 7163, 7175, 7239, 7335, 7399, 7447, 7511, 7607, 7671, 7695, 7759, 7855, 7919, 7967, 8031, 8127, 8191, 8193, 8385, 8481, 8673, 8721, 8913, 9009, 9201, 9225, 9417, 9513, 9705, 9753, 9945, 10041, 10233, 10245, 10437, 10533, 10725, 10773, 10965, 11061, 11253, 11277, 11469, 11565, 11757, 11805, 11997, 12093, 12285, 12291, 12483, 12579, 12771, 12819, 13011, 13107, 13299, 13323, 13515, 13611, 13803, 13851, 14043, 14139, 14331, 14343, 14535, 14631, 14823, 14871, 15063, 15159, 15351, 15375, 15567, 15663, 15855, 15903, 16095, 16191, 16383, 16385, 16513, 16705, 16833, 16929, 17057, 17249, 17377, 17425, 17553, 17745, 17873, 17969, 18097, 18289, 18417, 18441, 18569, 18761, 18889, 18985, 19113, 19305, 19433, 19481, 19609, 19801, 19929, 20025, 20153, 20345, 20473, 20485, 20613, 20805, 20933, 21029, 21157, 21349, 21477, 21525, 21653, 21845, 21973, 22069, 22197, 22389, 22517, 22541, 22669, 22861, 22989, 23085, 23213, 23405, 23533, 23581, 23709, 23901, 24029, 24125, 24253, 24445, 24573, 24579, 24707, 24899, 25027, 25123, 25251, 25443, 25571, 25619, 25747, 25939, 26067, 26163, 26291, 26483, 26611, 26635, 26763, 26955, 27083, 27179, 27307, 27499, 27627, 27675, 27803, 27995, 28123, 28219, 28347, 28539, 28667, 28679, 28807, 28999, 29127, 29223, 29351, 29543, 29671, 29719, 29847, 30039, 30167, 30263, 30391, 30583, 30711, 30735, 30863, 31055, 31183, 31279, 31407, 31599, 31727, 31775, 31903, 32095, 32223, 32319, 32447, 32639, 32767, 32769, 33153, 33345, 33729, 33825, 34209, 34401, 34785, 34833, 35217, 35409, 35793, 35889, 36273, 36465, 36849, 36873, 37257, 37449, 37833, 37929, 38313, 38505, 38889, 38937, 39321, 39513, 39897, 39993, 40377, 40569, 40953, 40965, 41349, 41541, 41925, 42021, 42405, 42597, 42981, 43029, 43413, 43605, 43989, 44085, 44469, 44661, 45045, 45069, 45453, 45645, 46029, 46125, 46509, 46701, 47085, 47133, 47517, 47709, 48093, 48189, 48573, 48765, 49149, 49155, 49539, 49731, 50115, 50211, 50595, 50787, 51171, 51219, 51603, 51795, 52179, 52275, 52659, 52851, 53235, 53259, 53643, 53835, 54219, 54315, 54699, 54891, 55275, 55323, 55707, 55899, 56283, 56379, 56763, 56955, 57339, 57351, 57735, 57927, 58311, 58407, 58791, 58983, 59367, 59415, 59799, 59991, 60375, 60471, 60855, 61047, 61431, 61455, 61839, 62031, 62415, 62511, 62895, 63087, 63471, 63519, 63903, 64095, 64479, 64575, 64959, 65151, 65535);

    public int[] minOperations(int[] nums) {
        int n = nums.length;
        int[] ans = new int[n];
        for (int i = 0; i < n; i++) {
            int num = nums[i];
            int idx = Collections.binarySearch(PALS, num);
            if (idx >= 0) {
                ans[i] = 0;
            } else {
                int insertIdx = -idx - 1;
                int minDist = Integer.MAX_VALUE;
                if (insertIdx < PALS.size()) {
                    minDist = Math.min(minDist, PALS.get(insertIdx) - num);
                }
                if (insertIdx > 0) {
                    minDist = Math.min(minDist, num - PALS.get(insertIdx - 1));
                }
                ans[i] = minDist;
            }
        }
        return ans;
    }
}
/*
3766. 将数字变成二进制回文数的最少操作
https://leetcode.cn/problems/minimum-operations-to-make-binary-palindrome/description/

第 171 场双周赛 T2。

给你一个整数数组 nums。
对于每个元素 nums[i]，你可以执行以下操作 任意 次（包括零次）：
- 将 nums[i] 加 1，或者
- 将 nums[i] 减 1。
如果一个数的二进制表示（不包含前导零）正读和反读都一样，则称该数为 二进制回文数。
你的任务是返回一个整数数组 ans，其中 ans[i] 表示将 nums[i] 转换为 二进制回文数 所需的 最小 操作次数。
提示：
1 <= nums.length <= 5000
1 <= nums[i] <= 5000

预处理。二分。
https://chat.deepseek.com/a/chat/s/cdd2905b-e2ba-43a0-a6a7-76f3ed20615b
时间复杂度 O(nlogU)。其中 U = 5000 是 nums[i] 的最大值。
 */